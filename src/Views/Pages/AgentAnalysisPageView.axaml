<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MarketAssistant.ViewModels"
             xmlns:views="using:MarketAssistant.Views.Components"
             xmlns:controls="using:MarketAssistant.Views.Controls"
             xmlns:converts="using:MarketAssistant.Converts"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="MarketAssistant.Views.Pages.AgentAnalysisPageView"
             x:DataType="vm:AgentAnalysisViewModel"
             x:Name="ParentPage">

    <Grid ColumnDefinitions="*,Auto">
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <Grid Grid.Column="0" ClipToBounds="True">
            <!-- è¿›åº¦æ˜¾ç¤ºåŒºåŸŸ - ä»…åœ¨åˆ†æžæ—¶æ˜¾ç¤º -->
            <views:ProgressDisplayView 
                IsVisible="{Binding IsBusy}"
                IsProgressVisible="{Binding IsBusy}"
                IsAnalysisInProgress="{Binding IsAnalysisInProgress}"
                AnalysisStage="{Binding AnalysisStage}"/>

            <!-- åˆ†æžå®ŒæˆåŽçš„å†…å®¹åŒºåŸŸï¼ˆåŒ…å«æµ®åŠ¨æ“ä½œæŒ‰é’®ï¼‰ -->
            <Grid IsVisible="{Binding IsBusy, Converter={x:Static BoolConverters.Not}}">
                <!-- æ™ºèƒ½åˆ†æžæŠ¥å‘ŠåŒºåŸŸ -->
                <ContentControl Content="{Binding AnalysisReportViewModel}">
                    <ContentControl.ContentTemplate>
                        <DataTemplate x:DataType="vm:AnalysisReportViewModel">
                            <views:AnalysisReportView DataContext="{Binding}"/>
                        </DataTemplate>
                    </ContentControl.ContentTemplate>
                </ContentControl>
            
                <!-- æ°´å°æŽ§ä»¶ -->
                <controls:WatermarkView 
                    Text="æ•°æ®æ¥æºç½‘ç»œï¼Œä»…ä¾›å‚è€ƒã€‚æŠ•èµ„æœ‰é£Žé™©ï¼Œå…¥å¸‚éœ€è°¨æ…Žï¼" 
                    OpacityValue="0.4" 
                    Angle="-30" 
                    FontSize="28" 
                    HorizontalRepeatCount="2" 
                    VerticalRepeatCount="4" 
                    ZIndex="999" />
            
                <!-- æµ®åŠ¨æ“ä½œæŒ‰é’®(FAB) -->
                <StackPanel HorizontalAlignment="Right" 
                            VerticalAlignment="Bottom" 
                            ZIndex="1000" 
                            Margin="0,0,16,16" 
                            Spacing="8">
                    <!-- èŠå¤©æŒ‰é’® -->
                    <Button Content="ðŸ’¬" 
                            FontSize="24"
                            Width="56"
                            Height="56"
                            CornerRadius="28"
                            Background="{DynamicResource PrimaryBrush}"
                            Command="{Binding ToggleChatSidebarCommand}"
                            ToolTip.Tip="æ™ºèƒ½å¯¹è¯"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"/>                
                </StackPanel>
            </Grid>
        </Grid>

        <!-- èŠå¤©ä¾§è¾¹æ  -->
        <Border Grid.Column="1" 
                IsVisible="{Binding IsChatSidebarVisible}"
                Width="480"
                Background="{DynamicResource BackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1,0,0,0">
            <ContentControl Content="{Binding ChatSidebarViewModel}">
                <ContentControl.ContentTemplate>
                    <DataTemplate x:DataType="vm:ChatSidebarViewModel">
                        <views:ChatSidebarView DataContext="{Binding}"
                                              CloseCommand="{Binding #ParentPage.((vm:AgentAnalysisViewModel)DataContext).ToggleChatSidebarCommand}" />
                    </DataTemplate>
                </ContentControl.ContentTemplate>
            </ContentControl>
        </Border>
    </Grid>
</UserControl>

